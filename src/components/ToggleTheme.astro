---
// https://jklakus.co.uk/blogs/astro-darktheme
import Icon from "./Icon.astro";
---

<div class="inline-flex items-center">
    <label class="flex items-center justify-center cursor-pointer w-8 h-8 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600/80 rounded-full" for="light-switch">
        <button id="themeToggle">
            <span class="sr-only">Switch to light / dark version</span>
            <Icon class="w-4 h-4 dark:hidden" icon="sun" />
            <Icon class="w-4 h-4 hidden dark:block" icon="moon-stars" />
        </button>
    </label>
</div>

<script>
    const setToggleListener = () => {
      let toggleBtn = document.getElementById("themeToggle");
      const handleToggleClick = () => {
        const element = document.documentElement;
        element.classList.toggle("dark");
  
        const isDark = element.classList.contains("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      };
  
      toggleBtn?.addEventListener("click", handleToggleClick);
    };
  
    setToggleListener();
  
    document.addEventListener("astro:after-swap", setToggleListener);
  </script>
  
<script>
    const setTheme = () => {
      const theme = (() => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          return "dark";
        }
        return "light";
      })();
  
      if (theme === "light") {
        document.documentElement.classList.remove("dark");
      } else {
        document.documentElement.classList.add("dark");
      }
  
      window.localStorage.setItem("theme", theme || "light");
    };
  
    setTheme();
  
    document.addEventListener("astro:after-swap", setTheme);
  </script>